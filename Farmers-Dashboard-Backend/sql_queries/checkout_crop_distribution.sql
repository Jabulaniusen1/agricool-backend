-- This query extracts the number of crates checked-out per crop type in a particular day/year

SELECT
    acm.checkin_farmer as farmer_id,
    acm.cooling_unit_id as cooling_unit_id,
    -- Conditional aggregation for each crop
    SUM(CASE WHEN acm.crop_name = 'African star apple' THEN 1 ELSE 0 END) AS "African star apple(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'African star apple' THEN acm.weight ELSE 0 END) AS "African star apple(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Apple' THEN 1 ELSE 0 END) AS "Apple(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Apple' THEN acm.weight ELSE 0 END) AS "Apple(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Avocado' THEN 1 ELSE 0 END) AS "Avocado(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Avocado' THEN acm.weight ELSE 0 END) AS "Avocado(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Banana' THEN 1 ELSE 0 END) AS "Banana(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Banana' THEN acm.weight ELSE 0 END) AS "Banana(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Bathua (Chenopodium)' THEN 1 ELSE 0 END) AS "Bathua (Chenopodium)(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Bathua (Chenopodium)' THEN acm.weight ELSE 0 END) AS "Bathua (Chenopodium)(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Beans' THEN 1 ELSE 0 END) AS "Beans(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Beans' THEN acm.weight ELSE 0 END) AS "Beans(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Beetroot' THEN 1 ELSE 0 END) AS "Beetroot(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Beetroot' THEN acm.weight ELSE 0 END) AS "Beetroot(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Bitter Gourd' THEN 1 ELSE 0 END) AS "Bitter Gourd(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Bitter Gourd' THEN acm.weight ELSE 0 END) AS "Bitter Gourd(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Bitter Leaf' THEN 1 ELSE 0 END) AS "Bitter Leaf(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Bitter Leaf' THEN acm.weight ELSE 0 END) AS "Bitter Leaf(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Bottle Gourd' THEN 1 ELSE 0 END) AS "Bottle Gourd(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Bottle Gourd' THEN acm.weight ELSE 0 END) AS "Bottle Gourd(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Brinjal (Aubergine)' THEN 1 ELSE 0 END) AS "Brinjal (Aubergine)(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Brinjal (Aubergine)' THEN acm.weight ELSE 0 END) AS "Brinjal (Aubergine)(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Broccoli' THEN 1 ELSE 0 END) AS "Broccoli(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Broccoli' THEN acm.weight ELSE 0 END) AS "Broccoli(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Cabbage' THEN 1 ELSE 0 END) AS "Cabbage(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Cabbage' THEN acm.weight ELSE 0 END) AS "Cabbage(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Capsicum (Bell Pepper)' THEN 1 ELSE 0 END) AS "Capsicum (Bell Pepper)(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Capsicum (Bell Pepper)' THEN acm.weight ELSE 0 END) AS "Capsicum (Bell Pepper)(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Carrot' THEN 1 ELSE 0 END) AS "Carrot(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Carrot' THEN acm.weight ELSE 0 END) AS "Carrot(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Cauliflower' THEN 1 ELSE 0 END) AS "Cauliflower(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Cauliflower' THEN acm.weight ELSE 0 END) AS "Cauliflower(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Colacasia' THEN 1 ELSE 0 END) AS "Colacasia(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Colacasia' THEN acm.weight ELSE 0 END) AS "Colacasia(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Coriander' THEN 1 ELSE 0 END) AS "Coriander(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Coriander' THEN acm.weight ELSE 0 END) AS "Coriander(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Cucumber' THEN 1 ELSE 0 END) AS "Cucumber(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Cucumber' THEN acm.weight ELSE 0 END) AS "Cucumber(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Flat Beans' THEN 1 ELSE 0 END) AS "Flat Beans(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Flat Beans' THEN acm.weight ELSE 0 END) AS "Flat Beans(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Fluted pumpkin (leaves)' THEN 1 ELSE 0 END) AS "Fluted pumpkin (leaves)(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Fluted pumpkin (leaves)' THEN acm.weight ELSE 0 END) AS "Fluted pumpkin (leaves)(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Garlic' THEN 1 ELSE 0 END) AS "Garlic(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Garlic' THEN acm.weight ELSE 0 END) AS "Garlic(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Ginger' THEN 1 ELSE 0 END) AS "Ginger(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Ginger' THEN acm.weight ELSE 0 END) AS "Ginger(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Grapes' THEN 1 ELSE 0 END) AS "Grapes(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Grapes' THEN acm.weight ELSE 0 END) AS "Grapes(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Green Chilli' THEN 1 ELSE 0 END) AS "Green Chilli(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Green Chilli' THEN acm.weight ELSE 0 END) AS "Green Chilli(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Green Gram' THEN 1 ELSE 0 END) AS "Green Gram(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Green Gram' THEN acm.weight ELSE 0 END) AS "Green Gram(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Guava' THEN 1 ELSE 0 END) AS "Guava(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Guava' THEN acm.weight ELSE 0 END) AS "Guava(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Ivy Gourd' THEN 1 ELSE 0 END) AS "Ivy Gourd(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Ivy Gourd' THEN acm.weight ELSE 0 END) AS "Ivy Gourd(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Jackfruit' THEN 1 ELSE 0 END) AS "Jackfruit(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Jackfruit' THEN acm.weight ELSE 0 END) AS "Jackfruit(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Jute leaves' THEN 1 ELSE 0 END) AS "Jute leaves(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Jute leaves' THEN acm.weight ELSE 0 END) AS "Jute leaves(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Ladyfinger' THEN 1 ELSE 0 END) AS "Ladyfinger(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Ladyfinger' THEN acm.weight ELSE 0 END) AS "Ladyfinger(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Lemon' THEN 1 ELSE 0 END) AS "Lemon(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Lemon'THEN acm.weight ELSE 0 END) AS "Lemon(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Lettuce' THEN 1 ELSE 0 END) AS "Lettuce(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Lettuce' THEN acm.weight ELSE 0 END) AS "Lettuce(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Litchi' THEN 1 ELSE 0 END) AS "Litchi(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Litchi' THEN acm.weight ELSE 0 END) AS "Litchi(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Mango' THEN 1 ELSE 0 END) AS "Mango(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Mango' THEN acm.weight ELSE 0 END) AS "Mango(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Mint leaves' THEN 1 ELSE 0 END) AS "Mint leaves(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Mint leaves' THEN acm.weight ELSE 0 END) AS "Mint leaves(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Musk Melon' THEN 1 ELSE 0 END) AS "Musk Melon(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Musk Melon' THEN acm.weight ELSE 0 END) AS "Musk Melon(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Onion' THEN 1 ELSE 0 END) AS "Onion(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Onion' THEN acm.weight ELSE 0 END) AS "Onion(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Orange' THEN 1 ELSE 0 END) AS "Orange(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Orange' THEN acm.weight ELSE 0 END) AS "Orange(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Other' THEN 1 ELSE 0 END) AS "Other(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Other' THEN acm.weight ELSE 0 END) AS "Other(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Papaya' THEN 1 ELSE 0 END) AS "Papaya(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Papaya' THEN acm.weight ELSE 0 END) AS "Papaya(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Peach' THEN 1 ELSE 0 END) AS "Peach(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Peach' THEN acm.weight ELSE 0 END) AS "Peach(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Pear' THEN 1 ELSE 0 END) AS "Pear(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Pear' THEN acm.weight ELSE 0 END) AS "Pear(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Peas' THEN 1 ELSE 0 END) AS "Peas(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Peas' THEN acm.weight ELSE 0 END) AS "Peas(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Pineapple' THEN 1 ELSE 0 END) AS "Pineapple(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Pineapple' THEN acm.weight ELSE 0 END) AS "Pineapple(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Pointed Gourd' THEN 1 ELSE 0 END) AS "Pointed Gourd(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Pointed Gourd' THEN acm.weight ELSE 0 END) AS "Pointed Gourd(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Pomegranate' THEN 1 ELSE 0 END) AS "Pomegranate(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Pomegranate' THEN acm.weight ELSE 0 END) AS "Pomegranate(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Potato' THEN 1 ELSE 0 END) AS "Potato(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Potato' THEN acm.weight ELSE 0 END) AS "Potato(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Pumpkin' THEN 1 ELSE 0 END) AS "Pumpkin(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Pumpkin' THEN acm.weight ELSE 0 END) AS "Pumpkin(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Radish' THEN 1 ELSE 0 END) AS "Radish(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Radish' THEN acm.weight ELSE 0 END) AS "Radish(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Raw Banana' THEN 1 ELSE 0 END) AS "Raw Banana(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Raw Banana' THEN acm.weight ELSE 0 END) AS "Raw Banana(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Scent leaf' THEN 1 ELSE 0 END) AS "Scent leaf(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Scent leaf' THEN acm.weight ELSE 0 END) AS "Scent leaf(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Spinach' THEN 1 ELSE 0 END) AS "Spinach(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Spinach' THEN acm.weight ELSE 0 END) AS "Spinach(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Spring onion' THEN 1 ELSE 0 END) AS "Spring onion(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Spring onion' THEN acm.weight ELSE 0 END) AS "Spring onion(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Strawberry' THEN 1 ELSE 0 END) AS "Strawberry(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Strawberry' THEN acm.weight ELSE 0 END) AS "Strawberry(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Sweet Lime' THEN 1 ELSE 0 END) AS "Sweet Lime(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Sweet Lime' THEN acm.weight ELSE 0 END) AS "Sweet Lime(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Tapioca (Cassava)' THEN 1 ELSE 0 END) AS "Tapioca (Cassava)(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Tapioca (Cassava)' THEN acm.weight ELSE 0 END) AS "Tapioca (Cassava)(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Taro root' THEN 1 ELSE 0 END) AS "Taro root(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Taro root' THEN acm.weight ELSE 0 END) AS "Taro root(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Tomato' THEN 1 ELSE 0 END) AS "Tomato(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Tomato' THEN acm.weight ELSE 0 END) AS "Tomato(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Waterleaf' THEN 1 ELSE 0 END) AS "Waterleaf(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Waterleaf' THEN acm.weight ELSE 0 END) AS "Waterleaf(Check-out-kg)",
    SUM(CASE WHEN acm.crop_name = 'Water Melon' THEN 1 ELSE 0 END) AS "Water Melon(Check-out)",
    SUM(CASE WHEN acm.crop_name = 'Water Melon' THEN acm.weight ELSE 0 END) AS "Water Melon(Check-out-kg)"

FROM
    analytics_crate_movements acm
WHERE
    acm.checkout_date >= '%(year)s-%(month)s-%(day)s 00:00:00'
    AND acm.checkout_date <= '%(year)s-%(month)s-%(day)s 23:59:59'
GROUP BY
    acm.checkin_farmer, acm.cooling_unit_id;
